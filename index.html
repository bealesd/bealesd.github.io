<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="prismLight.css" />
	<script src="prismLight.js"></script>

	<!-- <link rel="stylesheet" href="prismDark.css" />
	<script src="prismDark.js"></script> -->

	<title>David Beales Blog</title>

	<style>
		body {
			margin: 0px;
			padding: 0px;
			border: 0px;
			background-color: black;
		}

		#pageWrapper {
			position: absolute;
			z-index: 2;
			width: 100%;
			height: 100%;
			padding: 0px 0% 0px 0%;
		}

		#postsLink {
			display: inline-block;
			box-sizing: border-box;
			background-color: black;
			border-radius: 50px 0px 50px 0px;
			padding-top: 10px;
			padding-bottom: 10px;

			color: white;
			text-align: center;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
			letter-spacing: 1px;
			font-weight: 900;
			text-transform: uppercase;
			font-size: 40px;
		}

		#postsLink:hover {
			background-color: white;
			color: black;
			transition: all 1.5s ease-out;
		}

		#canvas {
			z-index: 1;
			position: absolute;
			background-color: black;
		}

		.postLinkDiv {
			background-color: white;
			margin: 100px auto 100px auto;
			padding: 50px 0px 50px 0px;
			border-radius: 10px 10px 10px 10px;
			max-width: 650px;
			
		}

		.postLink {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			border-radius: 10px 10px 10px 10px;
			padding: 10px 10px 10px 10px;
			background-color: black;

			color: lightgray;
			text-align: center;
			font-size: 20px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
			
			transition: 1.3s ease-in-out;
		}

		.postLink:hover {
			color: black;
			background-color: lightgray;
			transition: all 1s ease-out;
		}

		.timestamp {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			color: rgb(144, 143, 143);
			font-size: 12px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		.tags {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			color: blue;
			font-size: 16px;
			font-weight: 800;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		.postContentDiv {
			background-color: white;
			/* margin: 100px 10% 100px 10%; */
			padding: 50px 0px 50px 0px;
			/* border-radius: 10px 10px 10px 10px; */
		}

		.postContent {
			display: block;
			margin-left: auto;
			margin-right: auto;
			/* width: 500px; */
			border-radius: 10px 10px 10px 10px;
			padding: 10px 10px 10px 10px;
			background-color: black;

			color: lightgray;
			text-align: left;
			font-size: 16px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
	</style>
</head>

<body>
	<canvas id='canvas'></canvas>

	<div id='pageWrapper'>


		<div id="postsLinkDiv" hidden>
			<a id="postsLink">David Beales Blog</a>
		</div>

		<div class="postLinkDiv" hidden>
			<p class="timestamp">13 April 2018</p>
			<a class="postLink" id="postOne">JavaScript Variables Part One</a>
			<p class="tags">
				<em>#JavaScript</em>
			</p>
		</div>

		<div class="postLinkDiv" hidden>
			<p class="timestamp">13 May 2018</p>
			<a class="postLink" id="postTwo">JavaScript Variables Part Two</a>
			<p class="tags">
				<em>#JavaScript</em>
			</p>
		</div>


		<div id="postOneDiv" class="postContentDiv" hidden>
			<div class="postContent">
				<h1 class="postHeading">JavaScript Variables Part One</h1>

				<h2>
					Variables and Scope
				</h2>

				<p>
					Like any language JavaScript has scopes and variables.
				</p>

				<p>
					Variables are pretty self explanatory, they store information. However what syntax you use to declare variables will make
					a massive difference to how your code behaves. Lets look at <em>var</em>.
				</p>

				<h3>
					Var
				</h3>

				<p>
					<em>Var</em> is commonly is used to delcare a variables (commonly in older code bases, but sometimes in new ones). The function below
					declares a variable foo and assigns bar to it.</p>

				<p>

					<pre class="line-numbers"><code class="language-javascript">function fooBar(){
    var foo = "bar"; 
	console.log(foo); 
}
fooBar(); print bar</code></pre>

				</p>
				<p>
					This behaviour seems completely reasonable, the variable foo is declared in the function fooBar. It exists only in the function
					scope of fooBar and cannot be accessed outside of that scope. So what is the issue with <em>var</em>?
				</p>

				<pre class="line-numbers"><code class="language-javascript">for (var index = 0; index &#60;; 99 index++){
	doSomeWork(index);
}
console.log(index); // print 98</code></pre>

				<p>
					Thats odd, you would expect an error when calling index outside of the for loop. Well not with <em>var</em>,
					it has no block scope. The same would apply with a while, switch, if, etc.
				</p>
				<h4>
					Hoisting Var
				</h4>
				<p>
					So <em>var</em> has no block scope, but does it do anything else exciting. Well, yes! It supports hosting.
				</p>

				<pre class="line-numbers"><code class="language-javascript">function fooBar(){
	foo = "bar";
	console.log(foo);
	var foo;
}
fooBar(); //prints bar</code></pre>

				<p>
					I forgot to declare foo using var before I assigned a value to it. Guess what var doesn't care, as long as foo is decalred
					somewhere in the function, you can assign to it. If your wondering, this is called hoisting. So declarations are hostied,
					but what about declaration and assignment in one. Lets try it out.
				</p>
			
				<pre class="line-numbers"><code class="language-javascript">function fooBar(){	
	console.log(foo);
	var foo = "bar";
}
fooBar(); //prints undefined</code></pre>
				
				<p>So what happenned. The varaible foo was hoisted (it was decalared), but the assignment happened
					after the foo was printed, at which point foo was undefined, i.e. it had no data.</p>
				<p>
				Hositing can be quite annoying. You might wany improve runtime efficiency in your application by not
				creating objects that aren't required.
				</p>
			<pre class="line-numbers"><code class="language-javascript">var stopMyCode = true;
if (stopMyCode) {
    return;
}
var myObjectThatShouldExist = 'iExist';
			</code></pre>
			<p>As you know myObjectThatShouldExist does exist due to hoisting,
				even though the return statement is called in the if block!</p>
			
			<h4>Global Var</h4>
			
			<p>Variables can be declared globally so they're available anywhere.</p>
			
			<pre class="line-numbers"><code class="language-javascript">var globalFoo = "bar";
console.log(globalFoo);//print bar
console.log(window.globalFoo);//print bar
window.console.log(window.globalFoo);//print bar
console.log(this.globalFoo);//print bar
</code></pre>
			<p>
			When using var it gets added to the global object (<em>window</em> in browser), which is also the same as <em>this</em>! 
			As a side note, <em>window</em> is also where most browser functionality sits, hence the confusing <em>window.console</em>.log!	
			</p>
			
			<h4>Var Idiosyncrasies</h4>
			
			<p>
				There are plenty of examples of unexpected <em>var</em> behaviour, commonly encountered in for loops.
			</p>
			
			<pre class="line-numbers"><code class="language-javascript">var arr = [];
for (var i=0; i < 3; i++) {
    arr.push(() => i);
}
console.log(arr.map(x => x())); // prints [3,3,3]
			</code></pre>
			
			<p>What happenned, why wasn't i incremented! 
			This is because <em>i</em> is bound to the same value outside of the annoymous function,
			therefore it only takes the last value that <em>i</em> was assigned to.
			So what is the solution?
			</p>
			
			<pre class="line-numbers"><code class="language-javascript">let arr = [];
for (let i=0; i < 3; i++) {
    arr.push(() => i);
}
console.log(arr.map(x => x())); // [1,2,3]
			</code></pre>
			<p>That seemed easy, lets have a quick peek at<em>let</em>.</p>
			
			<h3>
				Let and Const
			</h3>
			
			<p>
			In 2015 ECMA6 was released (JavaScript 6). 
			It introduced let and const, amongst other things.
			You may have guessed but <em>let</em> and <em>varconst</em> are the alternative to <em>var</em>.
			As we know var has no block scope. 
			Get ready for this, <em>let</em> allows you to declare a variable with block scope. 
			<em>Const</em> also allows you to do the same, but the value assigned is a constant.
			</p>
			
			<pre class="line-numbers"><code class="language-javascript">var x = 99; // x is 99
{ 
  let x = 9;  // x is 9
}
console.log(x); //x is 99
			</code></pre>
			<p>Let is used to decalre and assign x in its own scope (defined by curly braces).
			It does not affect the outer scope.</p>
			
						<pre class="line-numbers"><code class="language-javascript">var x = 99; // Here x is 99
{ 
  const x = 9;  // Here x is 9
}
console.log(x); //x is still 99
			</code></pre>
			<p>This time we're using <em>const</em> instead of <em>let</em>, which make no difference in this case, unless...</p>.
			
						<pre class="line-numbers"><code class="language-javascript">var x = 99; // Here x is 99
{ 
  const x = 9;  // Here x is 9
  x += 1; // TypeError: Assignment to constant variable.
}
			</code></pre>
			<p>
			Const x is declared and assigned in the inner scope. It is then incremented by 1, but this fails.
			As a const is a constant value, trying to change it will throw an error.
			</p>
			
			<h3>
				Conclusion
			</h3>
			
			<p>
			If you want block scope for the variables your declare and assign to, which you probably would, 
			use <em>let</em> or <em>const</em>.
			If you work with Javascript, you will come accross <em>var</em>, so make sure you understand it.
			</p>

			</div>

		</div>


	</div>

</body>

<script>
	let starColors = null;
	let ctx = null
	let canvas = null
	let starInterval = null;
	let pageAddresses = {
	  welcome: 'DavidBealesBlog',
	  posts: 'DavidBealesBlogPosts',
	  postOne: 'PostOne'
	}
	let pageAddress = pageAddresses.welcome;

	function swapJsonKeyValues(json) {
	    var key, invertedJson = {};
	    for (key in json) {
		if (json.hasOwnProperty(key)) {
		    invertedJson[json[key]] = key;
		}
	    }
	    return invertedJson;
	}
	
	function updatePageState(){
	    history.pushState(null, '', `${pageAddress}.html`);
	}
	
	//back button presses
	window.addEventListener('popstate', function (event) {
        	history.pushState(null, '', location.href);
		let relativePath = window.location.pathname;
		let invertedPageAddresses = swapJsonKeyValues(pageAddresses);
		let address = null;
		let addressKey = null;
		if (relativePath.match(/[A-Za-z]+\.html/) != null){
			address = relativePath.match(/[A-Za-z]+\.html/)[0].slice(0, -5);
		}
		if (invertedPageAddresses.hasOwnProperty(address)){
		    addressKey = invertedPageAddresses[address];
		}
		
		let addressKeys = Object.keys(pageAddresses);
		let addressIndex = (Object.keys(pageAddresses).indexOf(addressKey)) < 0 ? 0: 
			(Object.keys(pageAddresses).indexOf(addressKey));
		
		let newAdressKey = Object.keys(pageAddresses)[addressIndex];
		
		if (pageAddresses[newAdressKey] === pageAddresses.posts){
		    onPostsLoad();
		}
		else if (pageAddresses[newAdressKey] === pageAddresses.postOne){
		    onPageOneLoad();
		}
		else if (pageAddresses[newAdressKey] === pageAddresses.welcome){
			var a = 1;
		}
    	});

	window.addEventListener('load', function () {
  
		setPostsLinkDivPosition();
		document.getElementById('postsLink').addEventListener("click", function (event) {
			if (event.srcElement.id === 'postsLink') {
				onPostsLoad();
			}
		}.bind(this));
		document.getElementById('postOne').addEventListener("click", function (event) {
			if (event.srcElement.id === 'postOne') {
				onPageOneLoad();
			}
		}.bind(this));
		
		drawStarMap();
		onResizePage();
		
	}.bind(this));
	
	function onPageOneLoad(){
		stopStars();
		pageAddress = pageAddresses.postOne;
		updatePageState();
		clearPage();
		document.querySelector('#postOneDiv').hidden = false;
		resizePost();
	}
	
	function onPostsLoad(){
		this.interval = setInterval(setIntervalWrapper, 50);
		this.scale = 0.99;
		this.scaleChange = 0.01;
		function setIntervalWrapper() {
			shrinkLink();
			if (scale < 0.01) {
				clearInterval(this.interval);
				clearPage();
				loadPosts();
			}
		}	
	}

	function shrinkLink() {
		let div = document.getElementById('postsLinkDiv');
		let link = document.getElementById('postsLink');
		this.scale -= this.scaleChange;
		this.scaleChange += 0.001;
		link.style.transform = `scale(${this.scale})`;
		div.style.transform =  `scale(${this.scale})`;
	}

	function resizePost() {
		let windowWidth = window.innerWidth;
		if (windowWidth > 750) {
			document.querySelector('.postContent').style.width = '650px';
		}
		else {
			document.querySelector('.postContent').style.width = '80%';
		}
		document.querySelector('.postContent');
	}

	function setPostsLinkDivPosition() {
		let viewWidth = window.innerWidth;
		let viewHeight = window.innerHeight;
		let postsLinkDiv = document.getElementById('postsLinkDiv');
		let postsLink = document.getElementById('postsLink');
		postsLinkDiv.hidden = false;
		postsLinkDiv.style.marginTop = `${(viewHeight - postsLinkDiv.offsetHeight) / 2}px`;
		postsLink.style.paddingLeft = `${30}px`;
		postsLink.style.paddingRight = `${30}px`;
		let postsLinkGutter = (postsLinkDiv.offsetWidth - postsLink.offsetWidth) / 2;
		postsLink.style.marginLeft = `${postsLinkGutter}px`;
		let postsLinkDivGutter = (viewWidth - postsLinkDiv.offsetWidth) / 2;
		postsLinkDiv.style.marginLeft = `${postsLinkDivGutter}px`;
	}

	function clearPage() {
		document.querySelectorAll('#pageWrapper div').forEach(function (div) {
			div.hidden = true;
		});
		clearCanvas();
	}

	function loadPosts() {
		document.querySelectorAll('.postLinkDiv').forEach(function (div) {
			div.hidden = false;
		});
		pageAddress = pageAddresses.posts;
    updatePageState();
	}

	function clearCanvas() {
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
	}

	function updateCanvasSize() {
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
	}

	function hideCanvas() {
		document.querySelector('#canvas').hidden = true;
	}

	function drawStarMap() {
		this.canvas = document.getElementById('canvas');
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
		this.ctx = this.canvas.getContext('2d');
		this.starColors = {
			red: {
				fillColor: 'red',
				lineColor: '#8E2121'
			},
			green: {
				fillColor: 'green',
				lineColor: '#003300'
			},
			yellow: {
				fillColor: 'yellow',
				lineColor: '#AEBF14'
			},
			brightBlue: {
				fillColor: '#00C4FF',
				lineColor: '#14627A'
			},
			darkBlue: {
				fillColor: '#0D168D',
				lineColor: 'rgb(6, 9, 49)'
			},
			turqoise: {
				fillColor: '#00FFA2',
				lineColor: '#226E52'
			},
			orange: {
				fillColor: '#FF7700',
				lineColor: '#C46008'
			},
			white: {
				fillColor: '#FCE1FC',
				lineColor: '#EBB9EB'
			}
		}
		this.stars = [];
		let currentIteration = 0;
		let iterations = 10000;
		this.starInterval = setInterval(setIntervalForMaxIterations, 50);
    
		function setIntervalForMaxIterations() {
			renderStars();
			currentIteration++;
			if (currentIteration >= iterations)
				clearInterval(this.starInterval);
		}
	}
	function onResizePage() {
		window.addEventListener('resize', function () {
			let resizeTimeout;
			if (!resizeTimeout) {
				resizeTimeout = setTimeout(function () {
					resizeTimeout = null;
					updateCanvasSize();
					if (pageAddress === pageAddresses.welcome) {
            updatePageState();
						setPostsLinkDivPosition();
					}
					else if (pageAddress === pageAddresses.postOne) {
            updatePageState();
						resizePost();
					}
				}, 66);
			}
		}.bind(this));
	}

	function stopStars() {
		clearInterval(this.starInterval);
	}

	function renderStars() {
		clearCanvas();
		let star = randomStar(this.canvas.width, this.canvas.height);
		this.stars.push(star);
		stars.forEach(function (s) {
			drawStar(s);
			resizeStar(s);
		});
	}

	function resizeStar(star) {
		let starCount = this.stars.length;
		let change = randomRange(0.1, 0.2);
		let maxStarSze = 3;
		if (star.grow && star.size > maxStarSze)
			star.grow = false;
		if (star.grow)
			star.size += change;
		else
			star.size -= change;
		if (star.size < 0.5) {
			let removeIndex = this.stars.indexOf(star);
			this.stars = this.stars.removeItem(removeIndex);
		}
	}

	function drawStar(star) {
		this.ctx.beginPath();
		this.ctx.arc(star.x, star.y, star.size, 0, 2 * Math.PI, false);
		this.ctx.fillStyle = star.fillColor;
		this.ctx.fill();
		this.ctx.lineWidth = star.size;
		this.ctx.strokeStyle = star.lineColor;
		this.ctx.stroke();
	}

	function getRandomStarColor() {
		var starColorsIndex = Math.floor(Math.random() * Math.floor(Object.keys(this.starColors).length));
		return this.starColors[Object.keys(this.starColors)[starColorsIndex]];
	}

	function randomStar(maxX, maxY) {
		let startStarSize = randomRange(0.5, 1);
		let starColor = getRandomStarColor();
		return {
			x: randomRange(0, maxX),
			y: randomRange(0, maxY),
			size: startStarSize,
			fillColor: starColor.fillColor,
			lineColor: starColor.lineColor,
			grow: true
		};
	}

	function randomRange(min, max) {
		return Math.random() * (min - max) + max;
	}

	Array.prototype.removeItem = function (indexToRemove) {
		let newArray = [];
		for (let i = 0; i < this.length; i++) {
			if (i !== indexToRemove) {
				newArray.push(this[i]);
			}
		}
		return newArray;
	};
</script>

</html>
