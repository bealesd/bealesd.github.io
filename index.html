<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="prismLight.css" />
	<script src="prismLight.js"></script>

	<!-- <link rel="stylesheet" href="prismDark.css" />
	<script src="prismDark.js"></script> -->

	<title>David Beales Blog</title>

	<style>
		body {
			margin: 0px;
			padding: 0px;
			border: 0px;
			background-color: black;
		}

		#pageWrapper {
			position: absolute;
			z-index: 2;
			width: 100%;
			height: 100%;
			padding: 0px 0% 0px 0%;
		}

		#postsLinkDiv {
			background-color: rgba(0,255,65, 0.7);
			border-radius: 50px 0px 50px 0px;
			width: 400px;
			min-width: 400px;
			padding: 50px 0px 50px 0px;
		}

		#postsLink {
			display: inline-block;
			box-sizing: border-box;
			background-color: black;
			border-radius: 50px 0px 50px 0px;
			padding-top: 10px;
			padding-bottom: 10px;

			color: white;
			text-align: center;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
			letter-spacing: 1px;
			font-weight: 900;
			text-transform: uppercase;
			font-size: 20px;
		}

		#postsLink:hover {
			background-color: white;
			color: black;
			transition: all 1.5s ease-out;
		}

		#canvas {
			z-index: 1;
			position: absolute;
			background-color: black;
		}

		.postLinkDiv {
			background-color: white;
			margin: 100px auto 100px auto;
			padding: 50px 0px 50px 0px;
			border-radius: 10px 10px 10px 10px;
			max-width: 650px;
			
		}

		.postLink {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			border-radius: 10px 10px 10px 10px;
			padding: 10px 10px 10px 10px;
			background-color: black;

			color: lightgray;
			text-align: center;
			font-size: 20px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		.postLink:hover {
			color: black;
			background-color: lightgray;
			transition: all 1.5s ease-out;
		}

		.timestamp {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			color: rgb(144, 143, 143);
			font-size: 12px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		.tags {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			color: blue;
			font-size: 16px;
			font-weight: 800;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		.postContentDiv {
			background-color: white;
			/* margin: 100px 10% 100px 10%; */
			padding: 50px 0px 50px 0px;
			/* border-radius: 10px 10px 10px 10px; */
		}

		.postContent {
			display: block;
			margin-left: auto;
			margin-right: auto;
			/* width: 500px; */
			border-radius: 10px 10px 10px 10px;
			padding: 10px 10px 10px 10px;
			background-color: black;

			color: lightgray;
			text-align: left;
			font-size: 16px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
	</style>
</head>

<body>
	<canvas id='canvas'></canvas>

	<div id='pageWrapper'>


		<div id="postsLinkDiv" hidden>
			<a id="postsLink">David Beales Blog</a>
		</div>

		<div class="postLinkDiv" hidden>
			<p class="timestamp">13 April 2018</p>
			<a class="postLink" id="postOne">JavaScript Variables Part One</a>
			<p class="tags">
				<em>#JavaScript</em>
			</p>
		</div>

		<div class="postLinkDiv" hidden>
			<p class="timestamp">13 May 2018</p>
			<a class="postLink" id="postTwo">JavaScript Variables Part Two</a>
			<p class="tags">
				<em>#JavaScript</em>
			</p>
		</div>


		<div id="postOneDiv" class="postContentDiv" hidden>
			<div class="postContent">
				<h1 class="postHeading">JavaScript Variables Part One</h1>

				<h2>
					Variables and Scope
				</h2>

				<p>
					Like any language JavaScript has scopes and variables.
				</p>

				<p>
					Variables are pretty self explanatory, they store information. However what syntax you use to declare variables will make
					a massive difference to how your code behaves. Lets look at
					<em>'VAR'</em>.
				</p>

				<h3>
					Var
				</h3>

				<p>
					Var is commonly is used to delcare a variables (commonly in older code bases, but sometimes in new ones). The function below
					declares a variable foo and assigns bar to it.</p>

				<p>

					<pre class="line-numbers"><code class="language-javascript">function fooBar(){
    var foo = "bar"; 
	console.log(foo); 
}
fooBar(); print bar</code></pre>

				</p>
				<p>
					This behaviour seems completely reasonable, the variable foo is declared in the function fooBar. It exists only in the function
					scope of fooBar and cannot be accessed outside of that scope. So what is the issue with var?
				</p>

				<pre class="line-numbers"><code class="language-javascript">for (var index = 0; index &#60;; 99 index++){
	doSomeWork(index);
}
console.log(index); // print 98</code></pre>

				<p>
					Thats odd, you would expect an error when calling index outside of the for loop. Well not with var,
					<em>it has no block scope</em>. The same would apply with a while, switch, if, etc.
				</p>
				<h4>
					Hoisting
				</h4>
				<p>
					So var has no block scope, but does it do anything else exciting. Well, yes! It supports hosting.
				</p>

				<pre class="line-numbers"><code class="language-javascript">function fooBar(){
	foo = "bar";
	console.log(foo);
	var foo;
}
fooBar(); //prints bar</code></pre>

				<p>
					I forgot to declare foo using var before I assigned a value to it. Guess what var doesn't care, as long as foo is decalred
					somewhere in the function, you can assign to it. If your wondering, this is called hoisting. So declarations are hostied,
					but what about declaration and assignment in one. Lets try it out.
				</p>
			
				<pre class="line-numbers"><code class="language-javascript">function fooBar(){	
	console.log(foo);
	var foo = "bar";
}
fooBar(); //prints undefined</code></pre>
				
				<p>So what happenned. The varaible foo was hoisted (it was decalared), but the assignment happened
					after the foo was printed, at which point foo was undefined, i.e. it had no data.</p>
			
			<p hidden class="need to add">
			example of annoying hosting, your trying to improve runtime efficients, the less js objects the better!
var stopMyCode = true;
if (stopMyCode) {
    return;
}
var myObjectThatShouldExist = 'iExist';

As you know myObjectThatShouldExist does exist due to hoisting, even though the return statement is called in the if block.

Global var
One more thing with vairables, they can be declared globally so they're available anywhere.

var globalFoo = "bar";
console.log(globalFoo);//print bar
console.log(window.globalFoo);//print bar
window.console.log(window.globalFoo);//print bar
console.log(this.globalFoo);//print bar

Oh, and when using var it gets added to the global object (window when in a browser), which is also this! As a side note, window is also where most browser functionality sits, hence the annoying window.console.log!

Example of asynchronous var gone wrong:
let arr = [];
for (let i=0; i < 3; i++) {
    arr.push(() => i);
}
console.log(arr.map(x => x())); // [0,1,2]

what happenned: i is bound to the same value outside of the annoymous function.
with let

solution:
let arr = [];
for (var i=0; i < 3; i++) {
    arr.push(() => i);
}
console.log(arr.map(x => x())); // [3,3,3]

Let and const - ecma6?

In 2015 ecma6 was released (JavaScript 6). It introduced let and const, amongst other things. You may have guessed but let and const are the alternative to var.
As we know var has no block scope. Get ready for this, 'let' allows you to declare a variable with block scope, take a bow. Const also work within block scope, but allow you to decalre a constant variable.

example
1.
var x = 99; // Here x is 99
{ 
  let x = 9;  // Here x is 9
}
console.log(x); //x is still 99

2.
var x = 99; // Here x is 99
{ 
  const x = 9;  // Here x is 9
}
console.log(x); //x is still 99

3.
var x = 99; // Here x is 99
{ 
  const x = 9;  // Here x is 9
  x += 1; // TypeError: Assignment to constant variable.
}

example 1 shows x being declared in it own scope and not affecting the outer scope.
example 2 is much the same but using const, this make no difference, unless...
example 3, shows x being declared as a const in the inner scope and then incrementing the varriable x. As a const is a constant value changing it throws an error.

Conclusion,
If you want block scope for the variables your declare and assign to, which you probably would, use let or const. If you work with Javascript, you will come accross var, so make sure you understand it.
			</p>

			</div>

		</div>


	</div>

</body>

<script>
	let starColors = null;
	let ctx = null
	let canvas = null
	let starInterval = null;
	let pageAddress = 'David Beales Blog';
	// add an object of addresses 

	window.addEventListener('load', function () {
		setPostsLinkDivPosition();

		document.getElementById('postsLink').addEventListener("click", function (event) {
			if (event.srcElement.id === 'postsLink') {
				this.interval = setInterval(setIntervalWrapper, 50);
				this.scale = 0.99;
				this.scaleChange = 0.01;
				function setIntervalWrapper() {
					shrinkLink();
					if (scale < 0.01) {
						clearInterval(this.interval);
						clearPage();
						loadPosts();
						stopStars();
					}
				}
			}
		}.bind(this));

		document.getElementById('postOne').addEventListener("click", function (event) {
			if (event.srcElement.id === 'postOne') {
				pageAddress = "Post One";
				clearPage();
				document.querySelector('#postOneDiv').hidden = false;
				resizePost();
			}
		}.bind(this));

		drawStarMap();
		onResizePage();
	}.bind(this));

	function shrinkLink() {
		let div = document.getElementById('postsLinkDiv');
		let link = document.getElementById('postsLink');

		this.scale -= this.scaleChange;
		this.scaleChange += 0.001;

		link.style.transform = `scale(${this.scale})`;
		div.style.transform =  `scale(${this.scale})`;
	}

	function resizePost() {
		let windowWidth = window.innerWidth;
		if (windowWidth > 750) {
			document.querySelector('.postContent').style.width = '650px';
		}
		else {
			document.querySelector('.postContent').style.width = '80%';
		}
		document.querySelector('.postContent');

	}

	function setPostsLinkDivPosition() {
		let viewWidth = window.innerWidth;
		let viewHeight = window.innerHeight;
		let postsLinkDiv = document.getElementById('postsLinkDiv');

		let postsLink = document.getElementById('postsLink');
		postsLinkDiv.hidden = false;
		postsLinkDiv.style.marginTop = `${(viewHeight - postsLinkDiv.offsetHeight) / 2}px`;
		postsLink.style.paddingLeft = `${30}px`;
		postsLink.style.paddingRight = `${30}px`;
		let postsLinkGutter = (postsLinkDiv.offsetWidth - postsLink.offsetWidth) / 2;
		postsLink.style.marginLeft = `${postsLinkGutter}px`;

		let postsLinkDivGutter = (viewWidth - postsLinkDiv.offsetWidth) / 2;
		postsLinkDiv.style.marginLeft = `${postsLinkDivGutter}px`;
	}

	function clearPage() {
		document.querySelectorAll('#pageWrapper div').forEach(function (div) {
			div.hidden = true;
		});
		clearCanvas();
	}

	function loadPosts() {
		document.querySelectorAll('.postLinkDiv').forEach(function (div) {
			div.hidden = false;
		});
		pageAddress = 'David Beales Blog Posts'
	}

	function clearCanvas() {
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
	}

	function updateCanvasSize() {
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
	}

	function hideCanvas() {
		document.querySelector('#canvas').hidden = true;
	}

	function drawStarMap() {
		this.canvas = document.getElementById('canvas');
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
		this.ctx = this.canvas.getContext('2d');

		this.starColors = {
			red: {
				fillColor: 'red',
				lineColor: '#8E2121'
			},
			green: {
				fillColor: 'green',
				lineColor: '#003300'
			},
			yellow: {
				fillColor: 'yellow',
				lineColor: '#AEBF14'
			},
			brightBlue: {
				fillColor: '#00C4FF',
				lineColor: '#14627A'
			},
			darkBlue: {
				fillColor: '#0D168D',
				lineColor: 'rgb(6, 9, 49)'
			},
			turqoise: {
				fillColor: '#00FFA2',
				lineColor: '#226E52'
			},
			orange: {
				fillColor: '#FF7700',
				lineColor: '#C46008'
			},
			white: {
				fillColor: '#FCE1FC',
				lineColor: '#EBB9EB'
			}
		}
		this.stars = [];
		let currentIteration = 0;
		let iterations = 10000;
		this.starInterval = setInterval(setIntervalForMaxIterations, 50);
		function setIntervalForMaxIterations() {
			renderStars();
			currentIteration++;
			if (currentIteration >= iterations)
				clearInterval(this.starInterval);
		}
	}

	function onResizePage() {
		window.addEventListener('resize', function () {
			let resizeTimeout;
			if (!resizeTimeout) {
				resizeTimeout = setTimeout(function () {
					resizeTimeout = null;
					updateCanvasSize();
					if (pageAddress === 'David Beales Blog') {
						setPostsLinkDivPosition();
					}
					else if (pageAddress === 'Post One') {
						resizePost();
					}
				}, 66);
			}
		}.bind(this));
	}

	function stopStars() {
		clearInterval(this.starInterval);
	}

	function renderStars() {
		clearCanvas();
		let star = randomStar(this.canvas.width, this.canvas.height);
		this.stars.push(star);

		stars.forEach(function (s) {
			drawStar(s);
			resizeStar(s);
		});
	}

	function resizeStar(star) {
		let starCount = this.stars.length;
		let change = randomRange(0.1, 0.2);
		let maxStarSze = 3;
		if (star.grow && star.size > maxStarSze)
			star.grow = false;
		if (star.grow)
			star.size += change;
		else
			star.size -= change;
		if (star.size < 0.5) {
			let removeIndex = this.stars.indexOf(star);
			this.stars = this.stars.removeItem(removeIndex);
		}
	}

	function drawStar(star) {
		this.ctx.beginPath();
		this.ctx.arc(star.x, star.y, star.size, 0, 2 * Math.PI, false);
		this.ctx.fillStyle = star.fillColor;
		this.ctx.fill();
		this.ctx.lineWidth = star.size;
		this.ctx.strokeStyle = star.lineColor;
		this.ctx.stroke();
	}

	function getRandomStarColor() {
		var starColorsIndex = Math.floor(Math.random() * Math.floor(Object.keys(this.starColors).length));
		return this.starColors[Object.keys(this.starColors)[starColorsIndex]];
	}

	function randomStar(maxX, maxY) {
		let startStarSize = randomRange(0.5, 1);
		let starColor = getRandomStarColor();
		return {
			x: randomRange(0, maxX),
			y: randomRange(0, maxY),
			size: startStarSize,
			fillColor: starColor.fillColor,
			lineColor: starColor.lineColor,
			grow: true
		};
	}

	function randomRange(min, max) {
		return Math.random() * (min - max) + max;
	}

	Array.prototype.removeItem = function (indexToRemove) {
		let newArray = [];
		for (let i = 0; i < this.length; i++) {
			if (i !== indexToRemove) {
				newArray.push(this[i]);
			}
		}
		return newArray;
	};

</script>

</html>
