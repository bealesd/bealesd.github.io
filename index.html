<!DOCTYPE html>
<html>

<head>
	<title>David Beales Blog</title>

	<style>
		body {
			margin: 0px;
			padding: 0px;
			border: 0px;
		}

		#pageWrapper {
			position: absolute;
			z-index: 2;
			width: 100%;
			height: 100%;
			padding: 0px 0% 0px 0%;
		}

		#postsLinkDiv {
			position: absolute;
			top: 50%;
			left: 30%;
			right: 30%;
			width: 40%;
			min-width: 40%;
			height: 100px;
			-ms-transform: translateY(-50%);
			transform: translateY(-50%);
			background-color: #00FF41;
			border-radius: 50px 0px 50px 0px;
		}

		#postsLink {
			position: absolute;
			top: 50%;
			-ms-transform: translateY(-50%);
			transform: translateY(-50%);
			height: 20px;
			border-top: 3px solid rgba(255, 255, 255, 0);

			left: 10%;
			width: 80%;
			min-width: 80%;
			background-color: black;

			border-radius: 50px 0px 50px 0px;

			color: white;
			text-align: center;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}


		#postsLink:hover {
			background-color: white;
			color: black;
		}

		#canvas {
			z-index: 1;
			position: absolute;
			background-color: black;
		}

		#postsOneDiv {
			background-color: white;
			margin: 100px 10% 100px 10%;
			padding: 50px 0px 50px 0px;
			border-radius: 10px 10px 10px 10px;
		}

		#postsOne {
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			/* border-radius: 10px 10px 10px 10px; */
			padding: 10px 10px 10px 10px;
			background-color: black;

			color: lightgray;
			text-align: center;
			font-size: 20px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}

		#postsOne:hover {
			color: black;
			background-color: lightgray;
		}

		.timestamp{
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 80%;

			color: lightgray;
			font-size: 16px;
			font-family: "Avenir-Book", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
	</style>
</head>

<body>
	<canvas id='canvas'></canvas>

	<div id='pageWrapper'>


		<div id="postsLinkDiv" hidden>
			<a id="postsLink">David Beales Blog</a>
		</div>

		<div id="postsOneDiv" hidden>
			<p class="timestamp">13/04/2018</p>
			<a id="postsOne">JavaScript Variables Part One</a>
		</div>
	</div>

</body>

<script>
	let starColors = null;
	let ctx = null
	let canvas = null
	let starInterval = null;

	window.addEventListener('load', function () {
		document.getElementById('postsLinkDiv').hidden = false;

		document.getElementById('postsLink').addEventListener("click", function (event) {
			if (event.srcElement.id === 'postsLink') {
				clearPage();
				loadPosts();
				stopStars();
			}
		}.bind(this));

		drawStarMap();
		onResizePage();
	}.bind(this));

	function clearPage() {
		document.querySelectorAll('#pageWrapper div').forEach(function (div) {
			div.hidden = true;
		});
		clearCanvas();
	}

	function loadPosts() {
		document.getElementById('postsOneDiv').hidden = false;
	}

	function clearCanvas() {
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
	}

	function updateCanvasSize() {
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
	}

	function hideCanvas() {
		document.querySelector('#canvas').hidden = true;
	}

	function drawStarMap() {
		this.canvas = document.getElementById('canvas');
		this.canvas.width = window.innerWidth;
		this.canvas.height = window.innerHeight;
		this.ctx = this.canvas.getContext('2d');

		this.starColors = {
			red: {
				fillColor: 'red',
				lineColor: '#8E2121'
			},
			green: {
				fillColor: 'green',
				lineColor: '#003300'
			},
			yellow: {
				fillColor: 'yellow',
				lineColor: '#AEBF14'
			},
			brightBlue: {
				fillColor: '#00C4FF',
				lineColor: '#14627A'
			},
			darkBlue: {
				fillColor: '#0D168D',
				lineColor: 'rgb(6, 9, 49)'
			},
			turqoise: {
				fillColor: '#00FFA2',
				lineColor: '#226E52'
			},
			orange: {
				fillColor: '#FF7700',
				lineColor: '#C46008'
			},
			white: {
				fillColor: '#FCE1FC',
				lineColor: '#EBB9EB'
			}
		}
		this.stars = [];
		let currentIteration = 0;
		let iterations = 10000;
		this.starInterval = setInterval(setIntervalForMaxIterations, 50);
		function setIntervalForMaxIterations() {
			renderStars();
			currentIteration++;
			if (currentIteration >= iterations)
				clearInterval(this.starInterval);
		}
	}

	function onResizePage() {
		window.addEventListener('resize', function () {
			let resizeTimeout;
			if (!resizeTimeout) {
				resizeTimeout = setTimeout(function () {
					resizeTimeout = null;
					updateCanvasSize();
				}, 66);
			}
		}.bind(this));
	}

	function stopStars() {
		clearInterval(this.starInterval);
	}

	function renderStars() {
		clearCanvas();
		let star = randomStar(this.canvas.width, this.canvas.height);
		this.stars.push(star);

		stars.forEach(function (s) {
			drawStar(s);
			resizeStar(s);
		});
	}

	function resizeStar(star) {
		let starCount = this.stars.length;
		let change = randomRange(0.1, 0.2);
		let maxStarSze = 3;
		if (star.grow && star.size > maxStarSze)
			star.grow = false;
		if (star.grow)
			star.size += change;
		else
			star.size -= change;
		if (star.size < 0.5) {
			let removeIndex = this.stars.indexOf(star);
			this.stars = this.stars.removeItem(removeIndex);
		}
	}

	function drawStar(star) {
		this.ctx.beginPath();
		this.ctx.arc(star.x, star.y, star.size, 0, 2 * Math.PI, false);
		this.ctx.fillStyle = star.fillColor;
		this.ctx.fill();
		this.ctx.lineWidth = star.size;
		this.ctx.strokeStyle = star.lineColor;
		this.ctx.stroke();
	}

	function getRandomStarColor() {
		var starColorsIndex = Math.floor(Math.random() * Math.floor(Object.keys(this.starColors).length));
		return this.starColors[Object.keys(this.starColors)[starColorsIndex]];
	}

	function randomStar(maxX, maxY) {
		let startStarSize = randomRange(0.5, 1);
		let starColor = getRandomStarColor();
		return {
			x: randomRange(0, maxX),
			y: randomRange(0, maxY),
			size: startStarSize,
			fillColor: starColor.fillColor,
			lineColor: starColor.lineColor,
			grow: true
		};
	}

	function randomRange(min, max) {
		return Math.random() * (min - max) + max;
	}

	Array.prototype.removeItem = function (indexToRemove) {
		let newArray = [];
		for (let i = 0; i < this.length; i++) {
			if (i !== indexToRemove) {
				newArray.push(this[i]);
			}
		}
		return newArray;
	};

</script>

</html>